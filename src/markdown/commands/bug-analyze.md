# bug分析命令

调查并分析已报告bug的根本原因。

## 使用方式
```
/bug-analyze [bug名称]
```

## 阶段概览
**您的角色**：调查bug并识别根本原因

这是bug修复工作流的第二阶段。您的目标是理解bug发生的原因，并规划修复方案。

## 操作说明

**手动分析流程**：

1. **前置条件**
   - 确保 report.md 存在且内容完整
   - 加载bug报告以获取上下文
   - **加载调控文档**：
     ```bash
     # Windows:
     claude-code-spec-workflow get-content "C:\path\to\project\.claude\steering\tech.md"
     claude-code-spec-workflow get-content "C:\path\to\project\.claude\steering\structure.md"
     
     # macOS/Linux:
     claude-code-spec-workflow get-content "/path/to/project/.claude/steering/tech.md"
     claude-code-spec-workflow get-content "/path/to/project/.claude/steering/structure.md"
     ```
   - 完全理解所报告的问题

2. **调查流程**
   1. **代码调查**
      - 在代码库中搜索相关功能
      - 识别涉及的文件、函数和组件
      - 映射数据流，定位潜在故障点
      - 查找类似问题或模式

   2. **根本原因分析**
      - 确定bug的底层原因
      - 识别促成因素
      - 分析现有测试为何未捕获此问题
      - 评估影响范围与风险

   3. **解决方案规划**
      - 设计修复策略
      - 考虑替代方案
      - 规划测试方法
      - 识别潜在风险

3. **创建分析文档**
   - **遵循模板**：使用上方预加载上下文中的bug分析模板（请勿重新加载）
   - **阅读并遵循**：严格按模板结构填写所有章节
   - 按模板结构记录调查发现

## 模板使用要求
- **严格遵循结构**：精确使用 `.claude/templates/bug-analysis-template.md`
- **包含所有章节**：不得遗漏任何必需模板章节
- **详尽分析**：按模板格式进行全面调查

4. **调查指南**
   - **遵循 tech.md 标准**：在提出变更前理解现有模式
   - **尊重 structure.md**：明确修复应放置的位置
   - **彻底搜索**：查找现有工具、相似bug、相关代码
   - **系统性思考**：考虑数据流、错误处理、边界情况
   - **规划测试**：如何验证修复有效

5. **审批流程**
   - 提交完整的分析文档
   - **展示代码复用机会**：注明可协助修复的现有工具
   - **突出集成点**：说明修复方案如何融入现有架构
   - 询问：“此分析是否正确？如无问题，我们将进入实施修复阶段。”
   - 整合反馈并修订
   - 持续迭代直至获得明确批准
   - **关键要求**：未经用户明确批准，严禁进入下一阶段

## 分析指南

### 代码调查
- 使用搜索工具定位相关代码
- 理解现有错误处理模式
- 查找行为正确的相似功能
- 检查可能导致问题的近期变更

### 根本原因识别
- 不仅修复表象，要定位真实根源
- 考虑边界情况与错误条件
- 区分设计bug与实现错误
- 明确预期行为与实际行为差异

### 解决方案设计
- 优先采用最小化、精准修复
- 复用现有模式与工具
- 考虑向后兼容性
- 规划预防同类bug的措施

## 关键规则
- **严禁**未经用户明确批准进入下一阶段
- 仅接受清晰肯定答复：“是”、“批准”、“没问题”等
- 若用户反馈意见，需修改后重新请求批准
- 持续修订直至获得明确批准

## 下一阶段
获得批准后，请执行 `/bug-fix`。